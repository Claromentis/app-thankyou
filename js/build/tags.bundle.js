define(["jquery"],function(e){return function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var i={};return t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/intranet/thankyou/js/build/",t(t.s=2)}({"../../../node_modules/css-loader/index.js!../../../node_modules/sass-loader/lib/loader.js!./css/style.scss":function(e,t,i){t=e.exports=i("../../../node_modules/css-loader/lib/css-base.js")(),t.push([e.i,'.thank-you .thank-you-item {\n  list-style: none; }\n  .thank-you .thank-you-item:not(:first-of-type) {\n    margin-top: 20px; }\n\n.thank-you .thank-you-note {\n  background: #f5f5f5;\n  border-radius: 6px;\n  padding: 10px;\n  position: relative;\n  border: 1px solid #e9e9e9; }\n  .thank-you .thank-you-note hr {\n    margin: 8px 0;\n    border-color: #e7e7e7; }\n  .thank-you .thank-you-note:after, .thank-you .thank-you-note:before {\n    top: 100%;\n    content: " ";\n    border: solid transparent;\n    height: 0;\n    width: 0;\n    position: absolute;\n    pointer-events: none; }\n  .thank-you .thank-you-note:after {\n    border-color: transparent;\n    border-top-color: #f5f5f5;\n    border-width: 8px;\n    margin-left: -10px;\n    right: 10px; }\n  .thank-you .thank-you-note:before {\n    border-color: transparent;\n    border-top-color: #e9e9e9;\n    border-width: 10px;\n    margin-left: -8px;\n    right: 8px; }\n  .thank-you .thank-you-note .thankyou-link-border {\n    border-left: 1px solid #e7e7e7;\n    margin-left: 3px;\n    padding-left: 6px;\n    display: inline-block; }\n\n.thank-you .thank-you-meta {\n  margin-top: 15px;\n  text-align: right; }\n  .thank-you .thank-you-meta .author-photo {\n    width: 40px; }\n\n.thank-you .no-decoration:hover, .thank-you .no-decoration:focus {\n  text-decoration: none; }\n\n.thank-you .user-photo {\n  width: 26px;\n  margin-bottom: 3px; }\n\n.thank-you .thank-you-note a:nth-child(1) img {\n  margin-left: 8px; }\n\n.thank-you .js-like-component {\n  display: inline-block; }\n  .thank-you .js-like-component .liked.liked {\n    border-right: 1px solid #e7e7e7;\n    margin-right: 3px;\n    padding-right: 6px;\n    display: inline-block; }\n  .thank-you .js-like-component .glyphicons.glyphicons-thumbs-up {\n    width: 12px; }\n\n.thank-you .edit-tools {\n  display: block; }\n  .thank-you .edit-tools .edit-thanks {\n    border-right: 1px solid #e7e7e7;\n    margin-right: 3px;\n    padding-right: 6px; }\n  .thank-you .edit-tools .delete-thanks {\n    padding-left: 6px; }\n\n.panel .panel-heading .btn.pull-right.thank-you--button {\n  position: absolute;\n  right: 23px;\n  top: 14px; }\n\n.tile-thank-you.grid-stack-item-6[data-gs-width="1"] .thank-title {\n  display: none; }\n\n@media only screen and (max-width: 768px) {\n  .tile-thank-you .thank-title {\n    display: none; } }\n\n.comments-toggle-wrapper.comments-border {\n  border-left: 1px solid #e7e7e7;\n  margin-left: 3px;\n  padding-left: 6px;\n  display: inline-block; }\n  .comments-toggle-wrapper.comments-border .glyphicons-comments.glyphicons {\n    color: #595959; }\n\n.comments {\n  display: none; }\n\n.js-listable-item-admin-container .listable-item-admin-new {\n  background: greenyellow; }\n\n.js-listable-item-admin-container .listable-item-admin-modified {\n  background: #00A6C7; }\n\n.js-listable-item-admin-container .listable-item-admin-deleted {\n  background: red; }\n\n.js-listable-item-admin-container .lia-heading {\n  text-align: center; }\n',""])},"../../../node_modules/css-loader/lib/css-base.js":function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var i=this[t];i[2]?e.push("@media "+i[2]+"{"+i[1]+"}"):e.push(i[1])}return e.join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},s=0;s<this.length;s++){var o=this[s][0];"number"==typeof o&&(n[o]=!0)}for(s=0;s<t.length;s++){var r=t[s];"number"==typeof r[0]&&n[r[0]]||(i&&!r[2]?r[2]=i:i&&(r[2]="("+r[2]+") and ("+i+")"),e.push(r))}},e}},"../../../node_modules/style-loader/addStyles.js":function(e,t,i){function n(e,t){for(var i=0;i<e.length;i++){var n=e[i],s=f[n.id];if(s){s.refs++;for(var o=0;o<s.parts.length;o++)s.parts[o](n.parts[o]);for(;o<n.parts.length;o++)s.parts.push(c(n.parts[o],t))}else{for(var r=[],o=0;o<n.parts.length;o++)r.push(c(n.parts[o],t));f[n.id]={id:n.id,refs:1,parts:r}}}}function s(e){for(var t=[],i={},n=0;n<e.length;n++){var s=e[n],o=s[0],r=s[1],a=s[2],l=s[3],d={css:r,media:a,sourceMap:l};i[o]?i[o].parts.push(d):t.push(i[o]={id:o,parts:[d]})}return t}function o(e,t){var i=_(e.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=g[g.length-1];if("top"===e.insertAt)n?n.nextSibling?i.insertBefore(t,n.nextSibling):i.appendChild(t):i.insertBefore(t,i.firstChild),g.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");i.appendChild(t)}}function r(e){e.parentNode.removeChild(e);var t=g.indexOf(e);t>=0&&g.splice(t,1)}function a(e){var t=document.createElement("style");return e.attrs.type="text/css",d(t,e.attrs),o(e,t),t}function l(e){var t=document.createElement("link");return e.attrs.type="text/css",e.attrs.rel="stylesheet",d(t,e.attrs),o(e,t),t}function d(e,t){Object.keys(t).forEach(function(i){e.setAttribute(i,t[i])})}function c(e,t){var i,n,s;if(t.singleton){var o=y++;i=b||(b=a(t)),n=h.bind(null,i,o,!1),s=h.bind(null,i,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=l(t),n=p.bind(null,i,t),s=function(){r(i),i.href&&URL.revokeObjectURL(i.href)}):(i=a(t),n=u.bind(null,i),s=function(){r(i)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else s()}}function h(e,t,i,n){var s=i?"":n.css;if(e.styleSheet)e.styleSheet.cssText=k(t,s);else{var o=document.createTextNode(s),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(o,r[t]):e.appendChild(o)}}function u(e,t){var i=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}function p(e,t,i){var n=i.css,s=i.sourceMap,o=void 0===t.convertToAbsoluteUrls&&s;(t.convertToAbsoluteUrls||o)&&(n=v(n)),s&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */");var r=new Blob([n],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(r),a&&URL.revokeObjectURL(a)}var f={},m=function(e){var t;return function(){return void 0===t&&(t=e.apply(this,arguments)),t}}(function(){return window&&document&&document.all&&!window.atob}),_=function(e){var t={};return function(i){return void 0===t[i]&&(t[i]=e.call(this,i)),t[i]}}(function(e){return document.querySelector(e)}),b=null,y=0,g=[],v=i("../../../node_modules/style-loader/fixUrls.js");e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");t=t||{},t.attrs="object"==typeof t.attrs?t.attrs:{},void 0===t.singleton&&(t.singleton=m()),void 0===t.insertInto&&(t.insertInto="head"),void 0===t.insertAt&&(t.insertAt="bottom");var i=s(e);return n(i,t),function(e){for(var o=[],r=0;r<i.length;r++){var a=i[r],l=f[a.id];l.refs--,o.push(l)}if(e){n(s(e),t)}for(var r=0;r<o.length;r++){var l=o[r];if(0===l.refs){for(var d=0;d<l.parts.length;d++)l.parts[d]();delete f[l.id]}}}};var k=function(){var e=[];return function(t,i){return e[t]=i,e.filter(Boolean).join("\n")}}()},"../../../node_modules/style-loader/fixUrls.js":function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var i=t.protocol+"//"+t.host,n=i+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var s=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/)/i.test(s))return e;var o;return o=0===s.indexOf("//")?s:0===s.indexOf("/")?i+s:n+s.replace(/^\.\//,""),"url("+JSON.stringify(o)+")"})}},"./css/style.scss":function(e,t,i){var n=i("../../../node_modules/css-loader/index.js!../../../node_modules/sass-loader/lib/loader.js!./css/style.scss");"string"==typeof n&&(n=[[e.i,n,""]]);i("../../../node_modules/style-loader/addStyles.js")(n,{});n.locals&&(e.exports=n.locals)},"./js/src/tags.js":function(e,t,i){var n,s;n=[i(0),i("./css/style.scss")],void 0!==(s=function(e){var t=function(){var t=this;t.column_headings=[],t.new_item_key_preface="new-",t.row_new_class="listable-item-admin-new",t.row_modified_class="listable-item-admin-modified",t.row_deleted_class="listable-item-admin-deleted",t.class_editable_field="js-listable-item-admin-editable-field",t.class_editable_field_error="js-listable-item-admin-editable-field-error",t.row_class="js-listable-item-admin-row",t.button_create=e("#js-listable-item-admin-create"),t.button_class_edit="js-listable-item-admin-edit-button",t.button_class_reset="js-listable-item-admin-reset-button",t.button_class_delete="js-listable-item-admin-delete-button",t.button_next=e("#js-listable-item-admin-nav-next"),t.button_previous=e("#js-listable-item-admin-nav-previous"),t.button_save=e("#js-listable-item-admin-save"),t.button_cancel=e("#js-listable-item-admin-cancel"),t.limit=20,t.offset=0,t.page=1,t.page_count=1,t.html_template=e("#js-listable-item-admin-item-template"),t.template_heading=e("#js-lia-template-heading"),t.localised_edit=e("#js-lia-loc-edit").text(),t.localised_delete=e("#js-lia-loc-delete").text(),t.localised_save_edit=e("#js-lia-loc-save-edit").text(),t.localised_reset=e("#js-lia-loc-reset").text(),t.items_list=e("#js-listable-item-admin-list"),t.loaded_items={},t.unlocked_items={},t.modified_items={},t.item_errors={},t.displayed_ids=[],t.deleted_items_ids=[],t.new_item_ids=[],t.editable_field_names=[],t.new_offset=1,t.saveUrl="/api/thankyou/v2/tags",t.errors_banner=e("#js-listable-item-admin-errors"),t.no_results_banner=e("#js-listable-item-admin-no-results"),t.items_list.on("click","."+t.button_class_edit,function(){t.toggleEditMode(this.closest("."+t.row_class).getAttribute("data-id"))}),t.items_list.on("click","."+t.button_class_reset,function(){var e=this.closest("."+t.row_class).getAttribute("data-id");t.resetEdit(e),t.refreshDisplay()}),t.items_list.on("click","."+t.button_class_delete,function(){var e=this.closest("."+t.row_class).getAttribute("data-id");t.deleteItem(e)}),t.button_create.click(function(){t.createNew()}),t.button_next.click(function(){t.changePage(t.page+1)}),t.button_previous.click(function(){t.changePage(t.page-1)}),t.button_save.click(function(){t.save()}),t.button_cancel.click(function(){t.resetAll()}),t.loadPageCount()};return t.prototype.createNew=function(){var t=e(e.parseHTML(_.template(this.html_template.html())({}))),i={};this.fillItemFromRow(t,i);var n=this.new_item_key_preface+this.new_offset;this.new_offset++,this.loaded_items[n]=i,this.new_item_ids.unshift(n),this.displayed_ids.unshift(n),this.checkModified(),this.toggleEditMode(n)},t.prototype.changePage=function(e){var t=this;this.page=e,this.offset=(t.page-1)*this.limit,this.loadItems(this.limit,this.offset,function(e){t.displayed_ids=[];for(var i in t.new_item_ids)t.displayed_ids.push(t.new_item_ids[i]);for(var n in e)t.loaded_items[n]=e[n],t.displayed_ids.push(n);t.refreshDisplay()}),this.checkPageNavigation()},t.prototype.loadItems=function(t,i,n){e.ajax("/api/thankyou/v2/tags?limit="+t+"&offset="+i).done(function(e){"function"==typeof n&&n(e)})},t.prototype.fillItemFromRow=function(t,i){t.find("."+this.class_editable_field).each(function(){var t=e(this),n=t.attr("type"),s=t.attr("data-name"),o=null;"text"===n?(o=t.val(),t.val(o)):"checkbox"===n?o=t.prop("checked"):console.log("Unsupported field type "+n),i[s]=o})},t.prototype.toggleEditMode=function(e){e in this.unlocked_items?(this.updateItemFromForm(e),delete this.unlocked_items[e]):this.unlocked_items[e]=!0,this.refreshDisplay()},t.prototype.deleteItem=function(e){this.new_item_ids.includes(e)?this.forgetItem(e):this.deleted_items_ids.includes(e)||this.deleted_items_ids.push(e),this.refreshDisplay()},t.prototype.forgetItem=function(e){if(this.new_item_ids.includes(e)){var t=this.new_item_ids.indexOf(e);this.new_item_ids.splice(t,1)}if(this.displayed_ids.includes(e)){var i=this.displayed_ids.indexOf(e);this.displayed_ids.splice(i,1)}if(e in this.modified_items&&delete this.modified_items[e],e in this.loaded_items&&delete this.loaded_items[e],e in this.unlocked_items&&delete this.unlocked_items[e],this.deleted_items_ids.includes(e)){var n=this.deleted_items_ids.indexOf(e);this.deleted_items_ids.splice(n,1)}e in this.item_errors&&delete this.item_errors[e]},t.prototype.loadPageCount=function(){var t=this;e.ajax("/api/thankyou/v2/tags/total").done(function(e){t.page_count=Math.ceil(e/t.limit),t.changePage(t.page)})},t.prototype.getItem=function(e){return e in this.modified_items?this.modified_items[e]:this.loaded_items[e]},t.prototype.getModifiedItem=function(e){return e in this.modified_items||(this.modified_items[e]=JSON.parse(JSON.stringify(this.loaded_items[e]))),this.modified_items[e]},t.prototype.updateItemFromForm=function(t){var i=e("."+this.row_class+"[data-id="+t+"]"),n=this.getModifiedItem(t);this.fillItemFromRow(i,n),_.isEqual(n,this.loaded_items[t])&&this.resetEdit(t),this.refreshDisplay()},t.prototype.resetAll=function(){var e;for(e in this.new_item_ids)this.forgetItem(this.new_item_ids[e]);for(var t in this.modified_items)this.resetEdit(t);for(e in this.deleted_items_ids)this.resetEdit(this.deleted_items_ids[e]);this.refreshDisplay()},t.prototype.resetEdit=function(e){delete this.modified_items[e],delete this.item_errors[e],this.deleted_items_ids.includes(e)&&this.deleted_items_ids.splice(this.deleted_items_ids.indexOf(e)),this.new_item_ids.includes(e)&&this.getModifiedItem(e)},t.prototype.save=function(){var t=this;t.item_errors={};var i=t.new_item_ids,n=t.modified_items,s=t.saveUrl,o={created:{},modified:{},deleted:t.deleted_items_ids};for(var r in n)i.includes(r)?o.created[r]=n[r]:o.modified[r]=n[r];e.ajax({url:s,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(o)}).done(function(e){"errors"in e&&(t.item_errors=e.errors);for(var i in t.loaded_items)i in t.item_errors||t.forgetItem(i);t.changePage(1),t.loadPageCount()})},t.prototype.refreshDisplay=function(){this.items_list.empty();for(var t in this.column_headings){var i=e(e.parseHTML(_.template(this.template_heading.html())({})));i.append(this.column_headings[t]),this.items_list.append(i)}Object.keys(this.item_errors).length>0?this.errors_banner.show():this.errors_banner.hide();var n=this.displayed_ids;if(0===n.length)this.no_results_banner.show();else{this.no_results_banner.hide();for(var t in n){var s=this.getItem(n[t]);this.items_list.append(this.displayRow(n[t],s))}}this.checkModified()},t.prototype.displayRow=function(t,i){var n=this.new_item_ids.includes(t),s=t in this.unlocked_items,o=t in this.modified_items,r=this.deleted_items_ids.includes(t),a=e(e.parseHTML(_.template(this.html_template.html())({})));n?a.addClass(this.row_new_class):r?a.addClass(this.row_deleted_class):o&&a.addClass(this.row_modified_class);var l=a.find("."+this.button_class_edit),d=a.find("."+this.button_class_reset),c=a.find("."+this.button_class_delete);return a.find("."+this.class_editable_field).prop("disabled",!s),l.text(s?this.localised_save_edit:this.localised_edit),c.text(this.localised_delete),d.text(this.localised_reset),l.hide(),d.hide(),c.hide(),(!n&&(r||o)||n&&s)&&d.show(),r||l.show(),(n&&!s||!r&&!s&&!o)&&c.show(),a.attr("data-id",t),this.fillRowFields(t,a,i),a},t.prototype.fillRowFields=function(t,i,n){var s=this;i.find("."+this.class_editable_field).each(function(){var i=e(this),o=i.attr("type"),r=i.attr("data-name"),a=r in n?n[r]:null;if("text"===o?i.val(a):"checkbox"===o?i.attr("checked",a):console.log("Unsupported field type "+o),t in s.item_errors&&r in s.item_errors[t]){var l=i.next("."+s.class_editable_field_error);l.length>0&&l.text(s.item_errors[t][r])}})},t.prototype.checkModified=function(){0!==Object.keys(this.modified_items).length||this.deleted_items_ids.length>0?(this.button_save.show(),this.button_cancel.show()):(this.button_save.hide(),this.button_cancel.hide())},t.prototype.checkPageNavigation=function(){var e=this.page;1===e?this.button_previous.hide():this.button_previous.show(),e<this.page_count?this.button_next.show():this.button_next.hide()},t.prototype.getFieldsFromTemplate=function(){var t=e(e.parseHTML(this.html_template.html())),i=[];t.find("."+this.class_editable_field).each(function(){i.push(e(this).attr("data-name"))}),this.editable_field_names=i},new t}.apply(t,n))&&(e.exports=s)},0:function(t,i){t.exports=e},2:function(e,t,i){e.exports=i("./js/src/tags.js")}})});