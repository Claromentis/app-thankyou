define(["jquery","cla_select2"],function(t,e){return function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/intranet/thankyou/js/build/",e(e.s=2)}({"./js/src/thankYouRepository.js":function(t,e,n){var o,r;o=[n(0)],void 0!==(r=function(){var t=function(){};return t.prototype.get=function(t,e,n,o,r){var i="/api/thankyou/v2/thanks/",a=[];Number.isNaN(t)||(i+=t),e&&a.push("thanked"),n&&a.push("tags");var s=a.length;if(s>0){i+="?";for(var l=0;l<s;l++)i+=a[l]+"=1",l!==s-1&&(i+="&")}var u={url:i};o&&(u.success=o),r&&(u.error=r),$.ajax(u)},t.prototype.save=function(t,e,n,o){var r="/api/thankyou/v2/thankyou";null!==t&&(r+="/"+t);var i={url:r,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(e)};n&&(i.success=n),o&&(i.error=o),$.ajax(i)},t.prototype.delete=function(t,e,n){var o={url:"/api/thankyou/v2/thankyou/"+t,type:"DELETE"};e&&(o.success=e),n&&(o.error=n),$.ajax(o)},new t}.apply(e,o))&&(t.exports=r)},"./js/src/thankyou.js":function(t,e,n){var o,r;o=[n(0),n(1),n("./js/src/thankYouRepository.js")],void 0!==(r=function(t,e,n){var o=function(t){this.repository=n,this.list=t,this.modal=t.find(".js-thank_you-modal").first(),this.form=this.modal.find(".js-thank_you-form"),this.delete_modal=t.find(".js-thank_you-delete-modal"),this.delete_form=this.delete_modal.find(".js-thank_you-delete-form"),this.form_error_template=_.template(this.modal.find(".js-form-error-template").html()),this.tags_config={width:"100%",allowClear:!0,ajax:{url:"/api/thankyou/v2/tags",dataType:"json",data:function(t){return{name:t.term,active:!0,limit:50}},processResults:function(t){for(var e=[],n=t.length,o=0;o<n;o++)e.push({id:t[o].id,text:t[o].name});return{results:e}}},placeholder:lmsg("thankyou.common.tags.multiselect")},this.configureTags(),this.registerEventListeners()};return o.prototype.configureTags=function(){this.form.find('select[name="thank_you_tags[]"]').select2(this.tags_config)},o.prototype.create=function(t){this.resetForm(),"object"==typeof t&&null!==t&&(this.setThanked(t),this.lockThanked(!0)),this.showModal(!0)},o.prototype.edit=function(t){var e=this;this.repository.get(t,!0,!0,function(t){e.populateForm(t),e.lockThanked(!1),e.showModal(!0)})},o.prototype.delete=function(t){this.setDeleteID(t),this.showDeleteModal(!0)},o.prototype.resetForm=function(){this.resetErrors(),this.setThankYouID(null),this.setThanked(null),this.setTags(null),this.setDescription(null)},o.prototype.populateForm=function(t){this.resetErrors(),this.setThankYouID(t.id),"thanked"in t&&this.setThanked(t.thanked),"tags"in t&&this.setTags(t.tags),this.setDescription(t.description)},o.prototype.getThankYouIDInput=function(){return this.form.find('input[name="id"]')},o.prototype.getThankedInput=function(){return this.form.find('select[name="thank_you_user[]"]')},o.prototype.getTagsInput=function(){return this.form.find('select[name="thank_you_tags[]"]')},o.prototype.getDescriptionInput=function(){return this.form.find('textarea[name="thank_you_description"]')},o.prototype.getDeleteIDInput=function(){return this.delete_form.find('input[name="id"]')},o.prototype.setThankYouID=function(t){this.getThankYouIDInput().val(t)},o.prototype.setThanked=function(t){var e=this.getThankedInput();if(e.val(null),e.html(null),Array.isArray(t))for(var n=t.length,o=0;o<n;o++)Number.isNaN(t[o].id)||null===t[o].id||Number.isNaN(t[o].object_type.id)||null===t[o].object_type.id||cla_multi_object_picker.addOption(t[o].object_type.id,t[o].id,t[o].object_type.name+": "+t[o].name,e.attr("id"));e.trigger("change")},o.prototype.setTags=function(t){var e=this.getTagsInput();if(e.val(null),e.html(null),Array.isArray(t))for(var n=t.length,o=0;o<n;o++){var r=new Option(t[o].name,t[o].id,null,!0);e.append(r)}e.trigger("change")},o.prototype.setDescription=function(t){this.getDescriptionInput().val(t)},o.prototype.setDescriptionMaxLength=function(t){this.getDescriptionInput().attr("maxlength",t)},o.prototype.setPreselected=function(t){this.form.find(".js-thank_you-thanked-names").text(t)},o.prototype.setDeleteID=function(t){this.getDeleteIDInput().val(t)},o.prototype.showModal=function(t){!0===t?this.modal.modal("show"):this.modal.modal("hide")},o.prototype.showDeleteModal=function(t){!0===t?this.delete_modal.modal("show"):this.delete_modal.modal("hide")},o.prototype.lockThanked=function(t){var e=this.getThankedInput();if(t){this.displayPicker(!1);for(var n="",o=cla_multi_object_picker.GetSelected(e),r=o.length,i=0;i<r;i++)n+=o[i].text();this.setPreselected(n),this.displayThankedNames(!0)}else this.displayThankedNames(!1),this.setPreselected(""),this.displayPicker(!0)},o.prototype.displayPicker=function(t){var e=this.form.find(".js-thank_you-picker-container");!0===t?e.show():e.hide()},o.prototype.displayThankedNames=function(t){var e=this.form.find(".js-thank_you-thanked-names-container");!0===t?e.show():e.hide()},o.prototype.submit=function(){t(".btn-submit-modal").prop("disabled",!0);var e=this;e.resetErrors();var n=e.getThankYouIDInput().val();""===n&&(n=null);var o=e.getThankedInput().val(),r=e.getDescriptionInput().val(),i={description:r,thanked:[]};if(Array.isArray(o))for(var a=o.length,s=0;s<a;s++){var l=o[s].split("_");i.thanked.push({oclass:parseInt(l[0]),id:parseInt(l[1])})}var u=e.getTagsInput();if(null!==u){var p=u.val();if(i.tags=[],Array.isArray(p))for(var h=p.length,d=0;d<h;d++)i.tags.push(parseInt(p[d]))}this.repository.save(n,i,function(t){window.location.reload()},function(n){t(".btn-submit-modal").prop("disabled",!1);var o=n.responseJSON,r=e.form.find(".js-form-error"),i=r.filter('[data-name="problem_details-title"]'),a=!1;if("invalid-params"in o&&Array.isArray(o["invalid-params"]))for(var s=o["invalid-params"].length,l=0;l<s;l++){var u=o["invalid-params"][l];if("name"in u){var p=r.filter('[data-name="'+u.name+'"]');p.length>0&&"reason"in u&&(e.addError(p,u.reason),a=!0)}}i.length>0&&"title"in o&&!a&&e.addError(i,o.title)})},o.prototype.resetErrors=function(){this.form.find(".js-form-error").empty()},o.prototype.addError=function(e,n){var o=t(this.form_error_template({message:n}));e.html(o)},o.prototype.submitDelete=function(){var t=this,e=t.getDeleteIDInput().val();this.repository.delete(e,function(t){location.reload()},function(e){var n=e.responseJSON,o=t.delete_form.find(".js-form-error"),r=o.filter('[data-name="problem_details-title"]');r.length>0&&"title"in n&&t.addError(r,n.title)})},o.prototype.registerEventListeners=function(){var e=this;this.list.on("click",".js-thank-you-create",function(){var n=null,o=t(this).attr("data-preselected_thanked");"string"==typeof o&&(n=JSON.parse(o)),e.create(n)}),this.list.on("click",".js-thank_you-edit-button",function(){e.edit(t(this).attr("data-id"))}),this.list.on("click",".js-thank_you-delete-button",function(){e.delete(t(this).attr("data-id"))}),this.list.on("click",".js-comments-reveal",function(e){t(e.target).closest(".js-thank-you").find(".js-comments").toggle()}),this.form.on("submit",null,this,function(t){t.preventDefault(),t.data.submit()}),this.delete_form.on("submit",null,this,function(t){t.preventDefault(),t.data.submitDelete()})},o}.apply(e,o))&&(t.exports=r)},0:function(e,n){e.exports=t},1:function(t,n){t.exports=e},2:function(t,e,n){t.exports=n("./js/src/thankyou.js")}})});