<include file="delete_modal.html" />

<ul name="items" datasrc="" class="list-unstyled thank-you js-thank-you-list">
	<ifempty><li name="no_thanks">No thanks</li></ifempty>
	<li>
		<txt name="thankyou:component:thankyou_users_name">Thank you</txt> <datasrc name="users"><a name="user_link"><txt name="user_name">John Smith</txt></a><txt name="delimiter_visible">, </txt></datasrc><txt name="has_description">:</txt>
		<txt name="has_description"><p name="description"></p></txt>
		<div class="row">
			<div class="col-xs-12">
				<p class="Right">&mdash; <a name="author_link"><txt name="author_name"></txt></a></p>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-6">
				<component name="like_component" class_key="like_it" object_type="thanks" object_id=""/>
			</div>
			<div class="col-xs-6 text-small">
				<p class="text-muted Right">
					<small>
						<txt name="edit_thanks">
							<a href="#" name="edit_thanks_link" class="js-edit-thanks" data-id="0"><txt name="thankyou:component:edit">Edit</txt></a>
							&bull;
							<a href="#" name="delete_thanks_link" class="js-delete-thanks" data-id="0"><txt name="thankyou:component:delete">Delete</txt></a>
							&bull;
						</txt>
						<span rel="tooltip" data-placement="bottom" title="" name="date_created">2 days ago</span>
					</small>
				</p>
			</div>
		</div>
	</li>
</ul>
<script type="text/javascript">
	requirejs(['jquery'], function ($) {
		var thankYouList = $('.js-thank-you-list');
		var modal = $('#thank_you_modal');
		var deleteModal = $('#thank_you_delete_modal');

		// Populate and show the modal when a note's edit button is clicked
		thankYouList.on('click', '.js-edit-thanks', function () {
			var data = $(this).data();

			$.ajax('/api/thankyou/v1/thanks/' + data.id, {
				success: function (data) {
					updateThanksForm(data);
					modal.modal('show');
				}
			});
		});

		// Show the delete modal when a note's delete button is clicked
		thankYouList.on('click', '.js-delete-thanks', function () {
			$('#delete_thank_you_id').val($(this).data('id'));
			deleteModal.modal('show');
		});

		/**
		 * Set the thanks item to display in the modal form.
		 *
		 * @param {object} item
		 */
		function updateThanksForm(item) {
			item = $.extend({
				id: 0,
				description: '',
				users: {}
			}, item);

			// Set ID and description
			$('#thank_you_id').val(item.id);
			$('#thank_you_description').val(item.description);

			// Clear and update users
			var thankYouUserSelect = $('#thank_you_user');
			thankYouUserSelect.val(null).trigger('change').html(null);

			if (!item.users)
				return;

			for (var i in item.users) {
				var user = item.users[i];

				var option = new Option(user.name, user.id, false, true);
				thankYouUserSelect.append(option);
			}

			thankYouUserSelect.trigger('change');
		}
	});
</script>
