<!--@head@
<unique_section name="thankyou_styles">
	<component class_key="css_loader" src="/intranet/thankyou/css/style.scss" >
</unique_section>
-->
<include file="includes/delete_modal.html"/>
<include file="includes/modal.html"/>
<div class="js-thank-you thank-you">
	<div class="thank-you-note">
		<txt name="thankyou:component:thankyou_users_name">Thank you</txt>
		<datasrc name="thanked">
			<a name="thanked_link" class="no-decoration" rel="tooltip" data-placement="top" title="">
				<img class="profile-img user-photo" name="profile_image" src="/appdata/people/no_photo.jpg" alt="">
				<txt name="thanked_name">John Smith</txt>
			</a>
			<span name="thanked_no_link">
				<img class="profile-img user-photo" name="profile_image" src="/appdata/people/no_photo.jpg" alt="">
				<txt name="thanked_name">John Smith</txt>
			 </span>
			<txt name="delimiter_visible">, </txt>
		</datasrc>
		<hr>
		<div class="row">
			<div class="col-xs-12">
				<txt name="has_description">
					<p name="description"></p>
				</txt>
			</div>
		</div>
		<div class="row small">
			<div class="col-xs-6">
				<component name="like_component" class_key="like_it" object_type="thanks" object_id=""/>
				<span name="comments" class="comments-toggle-wrapper comments-border">
					<a href="javascript:void(0)" class="js-comments-reveal" onclick="$(this).closest($('.js-thank-you')).find($('.js-comments')).toggle();"><span class="glyphicons-comments glyphicons"></span> <txt class="badge" name="comments_count">999</txt></a>
				</span>
			</div>
			<div class="col-xs-6">
				<span class="text-muted text-right edit-tools">
					<txt name="edit_thanks">
						<a href="javascript:void(0)" name="edit_thanks_link"
						   class="no-decoration edit-thanks" data-id="0" rel="tooltip"
						   title="${common:edit.body}"
						   onclick="cla_thank_you.Edit(this.getAttribute('data-id'));">
							<span class="glyphicons glyphicons-pencil" rel="tooltip" title=""></span>
						</a>
					</txt>
					<txt name="delete_thanks">
						<a href="javascript:void(0)" name="delete_thanks_link"
						   class="no-decoration delete-thanks" data-id="0" rel="tooltip"
						   title="${common:delete.body}"
						   onclick="cla_thank_you.Delete(this.getAttribute('data-id'));">
							<span class="glyphicons glyphicons-bin"></span>
						</a>
					</txt>
				</span>
			</div>
		</div>
	</div>
	<div class="thank-you-meta">
		<div class="media">
			<div class="media-body">
				<a name="author_link">
					<txt name="author_name"></txt>
				</a>
				<br>
				<small rel="tooltip" class="text-muted" data-placement="left" title="" name="date_created">2 days
					ago</small>
			</div>
			<div class="media-right">
				<a name="author_link" class="no-decoration">
					<img class="profile-img author-photo" name="profile_image" src="/appdata/people/no_photo.jpg">
				</a>
			</div>
		</div>
	</div>
	<div name="comments">
		<div class="js-comments comments">
			<component class="\Claromentis\Comments\UI\Comments" name="thank_you_comment" object_type="thanks" new_on_top="1" compact_mode="1"/>
		</div>
	</div>
</div>
<script type="text/javascript">
    var cla_thank_you = {
        Edit: function (id) {
            $.ajax('/api/thankyou/v2/thanks/' + id, {
                success: function (data) {
                    cla_thank_you.UpdateThanksForm(data);
                    cla_thank_you_modal.LockPicker(false);
                    cla_thank_you_modal.Show(true);
                }
            });
        },
		Delete: function (id) {
            cla_thank_you_delete_modal.SetObjectID(id);
            cla_thank_you_delete_modal.Show(true);
		},
        UpdateThanksForm: function (thank_you) {
            thank_you = $.extend({
                id: 0,
                description: '',
                users: {}
            }, thank_you);

            // Set ID and description
            cla_thank_you_modal.SetObjectID(thank_you.id);
            cla_thank_you_modal.SetDescription(thank_you.description);

            // Clear Thanked
            cla_thank_you_modal.SetPicker(null);

            if (!thank_you.thanked)
                return;

            // Set Thanked
            var thanked = [];
            for (var i in thank_you.thanked) {
                thanked.push({
                    object_type: {
                        id: thank_you.thanked[i].object_type.id,
                        name: thank_you.thanked[i].object_type.name
                    }, id: thank_you.thanked[i].id, name: thank_you.thanked[i].name
                });
            }
            cla_thank_you_modal.SetPicker(thanked);
        }
    };
</script>
